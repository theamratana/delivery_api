<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Telegram Login Test</title>
  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    .card { max-width: 760px; margin: 0 auto; border: 1px solid #ddd; border-radius: 8px; padding: 16px; }
    pre { background: #0b1020; color: #e6edf3; padding: 12px; border-radius: 6px; overflow: auto; }
    .muted { color: #666; }
    .row { margin: 12px 0; }
    label { display:block; font-weight:600; margin-bottom:6px; }
    input[type=text] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 8px 12px; border: 1px solid #444; background: #111; color: #fff; border-radius: 4px; cursor: pointer; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Telegram Login â€“ Local/QA Test</h2>
    <p class="muted">Use this page to get the Telegram Login payload (id, first_name, username, auth_date, hash) from your Telegram session, then paste it into your API call <code>/auth/telegram/verify</code>.</p>

    <div class="row">
      <label for="botUser">Bot username</label>
      <input id="botUser" type="text" value="BOT_USERNAME_HERE" />
      <div class="muted">Example: <code>patience_delivery_bot</code> (without @)</div>
    </div>

    <div class="row">
      <div id="widgetMount"></div>
    </div>

    <div class="row">
      <button id="copyBtn" disabled>Copy JSON to clipboard</button>
    </div>

    <h3>Result</h3>
    <pre id="out">{ /* Click the Telegram button above; your signed payload will appear here. */ }</pre>

    <p class="muted">Next: Paste this JSON into your HTTP client (e.g., Postman) as the request body to <code>POST http://localhost:8081/auth/telegram/verify</code>. Ensure your API is running and <code>TELEGRAM_BOT_TOKEN</code> is set on the server.</p>
  </div>

  <script>
    const mount = document.getElementById('widgetMount');
    const out = document.getElementById('out');
    const copyBtn = document.getElementById('copyBtn');
    const botUserInput = document.getElementById('botUser');

    function renderWidget() {
      mount.innerHTML = '';
      const botUser = (botUserInput.value || '').trim();
      if (!botUser || botUser === 'BOT_USERNAME_HERE') {
        out.textContent = 'Please enter your bot username first.';
        copyBtn.disabled = true;
        return;
      }

  const s = document.createElement('script');
  s.async = true;
  s.src = 'https://telegram.org/js/telegram-widget.js?22';
  s.dataset.telegramLogin = botUser;
  s.dataset.size = 'large';
  s.dataset.userpic = 'false';
  s.dataset.onauth = 'onTelegramAuth';
  s.dataset.requestAccess = 'write';
  mount.appendChild(s);
    }

    globalThis.onTelegramAuth = function(user) {
      out.textContent = JSON.stringify(user, null, 2);
      copyBtn.disabled = false;
    }

    botUserInput.addEventListener('change', renderWidget);
    botUserInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') renderWidget(); });
    renderWidget();

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(out.textContent);
        copyBtn.textContent = 'Copied!';
        setTimeout(() => (copyBtn.textContent = 'Copy JSON to clipboard'), 1200);
      } catch (e) {
        alert('Copy failed: ' + e);
      }
    });
  </script>
</body>
</html>
